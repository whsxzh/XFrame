 {_INCLUDE header.html}
   <link rel="stylesheet" type="text/css" href="view/assets/AdminLTE/dist/css/jquery.treemenu.css"/>
  <style>
.dropdown-btn{margin-left: -22px;background: none;border: none;line-height: 30px;font-size: 10px;}
#fenlei-input{border: 1px solid #ccc;padding-left: 15px;}
/*定义滚动条高宽及背景 高宽分别对应横竖滚动条的尺寸*/  
::-webkit-scrollbar{width: 6px;height: 6px;}  

/*定义滚动条轨道 内阴影+圆角*/  
::-webkit-scrollbar-track{-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);border-radius: 10px;}  
  
/*定义滑块 内阴影+圆角*/  
::-webkit-scrollbar-thumb{border-radius: 10px;-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.3);background-color: #F1F1EC;}  
button:focus,input:focus{outline: none;}
.banner-input1, .banner-input2{margin-right: 10%;}

/*tree*/
.tree{border: 1px solid #d2d6de;margin-top: 10px;width: 90%;}
.tree li a{color: #999;font-size: 16px;}
label{color: white;}

</style>
  <!--中心内容-->
  <div class="content-wrapper">
    <section class="content-header">
      <span style="font-size: 25px;">编辑广告</span>
      <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
        <li><a href="#">CMS管理</a></li>
        <li class="active">编辑广告</li>
      </ol>
    </section>
    <section class="content">
      <div class="row">
          <div class="box box-primary">
            <!--中心内容-->
            <div class="row">
              <div class="col-md-3"><img src="{_banner_image}" style="width: 100%;"></div>
            
              <div class="index-right-tab">

                <!--右侧内容-->
                <div class="col-md-9">
                  <div class="col-md-12"><button type="button" class="btn btn-primary btn-xs index-bj-back "   onclick="javascript:history.go(-1)">返回</button></div> 
                  <form method="post" action="xindex.php?m=common&act=saveImage" enctype="multipart/form-data" onsubmit="return check()">   
                  <div class="col-md-12 index-img1">
                      <div class="col-md-12">
                        <div id="click"><img src="{_image}"></div>
                        <a href="javascript:;" class="file">更换图片
                          <input type="file" id="photo" name="headurl">
                        </a>
                      </div>
                  </div>
                
                  
                  <div class="col-md-12">   
                    <div class="col-md-5">
                        <div class="index-group clearfix">
                          <label for="">标题：</label>
                          <input type="text" class="form-control form-input" placeholder="请输入标题名称" value='{_name}' id='name' style="height:34px;">
                        </div>
                    </div>                     
                  </div>  
                  
                  <div class="col-md-12">   
                   <div class="col-md-5">
                        <div class="index-group clearfix">
                           <label class="">位置：</label>
                            <select id="site" class="form-control form-select" style="width: 60%;" class="sss">
                              <option>请选择</option>
                                {_FOREACH sites site}   
                                    <option class="option" {_IF site=_banner_id}selected="selected"{ENDIF} value="{_banner_id}" data-value="0" >{_name}</option>                             
                                {ENDFOR} 
                                    
                            </select>
                          </div>
                      </div>                   
                  </div> 
                 
                  <div class="col-md-12">   
                   <div class="col-md-5">
                        <div class="index-group clearfix">
                           <label class="">链接类型：</label>
                           <select class="form-control form-select" id="banner-select" style="width: 60%;">
                              
                              {_IF type=1}
                                <option value="0" data-value="0" selected="selected">h5</option>
                                <option value="1" data-value="1">分类</option>
                                <option value="2" data-value="2">商品</option>
                                <option value="3" data-value="3">活动</option>
                                <option value="4" class="show"  disabled data-value="4">团购</option>
                                <option value="5" class="show"  disabled data-value="5">秒杀</option>
                              {ELSE}
                                <option value="0" data-value="0" >h5</option>
                                {_IF subtype=0}
                                  <option value="1" data-value="1" selected="selected">分类</option>
                                  <option value="2" data-value="2">商品</option>
                                  <option value="3" data-value="3">活动</option>
                                  <option value="4" class="show"  disabled data-value="4">团购</option>
                                  <option value="5" class="show"  disabled data-value="5">秒杀</option>
                                 {ENDIF}
                                 {_IF subtype=1}
                                  <option value="1" data-value="1">分类</option>
                                  <option value="2" data-value="2" selected="selected">商品</option>
                                  <option value="3" data-value="3">活动</option>
                                  <option value="4" class="show"  disabled data-value="4">团购</option>
                                  <option value="5" class="show"  disabled data-value="5">秒杀</option>
                                  {ENDIF}
                                  {_IF subtype=5}
                                  <option value="1" data-value="1">分类</option>
                                  <option value="2" data-value="2">商品</option>
                                  <option value="3" data-value="3" selected="selected">活动</option>
                                  <option value="4" class="show"  disabled data-value="4">团购</option>
                                  <option value="5" class="show"  disabled data-value="5">秒杀</option>
                                {ENDIF}
                                {_IF subtype=3}
                                  <option value="1" data-value="1">分类</option>
                                  <option value="2" data-value="2">商品</option>
                                  <option value="3" data-value="3" >活动</option>
                                  <option value="4" class="show"  selected="selected" data-value="4">团购</option>
                                  <option value="5" class="show"   data-value="5">秒杀</option>
                                {ENDIF}
                                {_IF subtype=4}
                                  <option value="1" data-value="1">分类</option>
                                  <option value="2" data-value="2">商品</option>
                                  <option value="3" data-value="3" >活动</option>
                                  <option value="4" class="show"   data-value="4">团购</option>
                                  <option value="5" class="show"  selected="selected" data-value="5">秒杀</option>                                  
                                  {ENDIF}
                              {ENDIF}
                              
                          </select>
                             
                          </div>
                      </div>                   
                  </div> 
                  
                  <div class="col-md-12"> 
                    <div class="col-md-5" id="test">
                        <div class="fenlei_item clearfix">
                          <div class="index-group">
                           <label for="">h5链接：</label>  <input id="link" type="text" value="{_link}" placeholder="链接" class=" form-input">
                          </div>
                          
                          <!--fenlei str-->
                            <div class="index-group" style="display: none;">
                            <label for="">搜索分类：</label>
                             <div class="dropdown">
                              <input type="text" id="fenlei-input" class="" value="{_fenlei_name}" class="form-input" placeholder="商品分类" style="background: none;">
                              <button class="dropdown-btn" type="button">▼</button>
                             </div>
                              <ul class="tree">
                              {_FOREACH cat}
                                <li>
                                  <a href="#about">{_name}</a>
                                  <ul>
                                      {_FOREACH son}
                                   
                                    <li>
                                      <a href="#">{_name2}</a>
                                      <ul class="sslist">
                                            {_FOREACH son}
                                        <li value="{_category_id2}" data="{_category_id2}">
                                          <a href="#jobs3">{_name2}</a>
                                        </li>
                                            {ENDFOR}
                                      </ul>
                                    </li>
                                      {ENDFOR}
                                  </ul>
                                </li>
                                {ENDFOR}
                              </ul>
                          </div>
                          <!--fenlei end-->
                          <div class="index-group">
                            
                              <label for="" style="line-height: 20px;">编辑商品：</label>
                              <a  onclick="showweb()" style="border: 1px solid #d2d6de;padding: 2% 1% 2% 1%;color: #999999;overflow: hidden;text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2;-webkit-box-orient: vertical;cursor: pointer;" id='inputString'>                       
                                {_shangpin_name}
                              </a>
                          </div>
                          

                        <div class="index-group">
                           <label class="">活动列表：</label>
                            
                           <select class="form-control form-select" id="activity-select" style=" width: 36%; float: left;">
                              <option value=0>请选择</option>
                                  {_FOREACH activity category_ids}                    
                                    <option value="{_category_id}" {_IF category_ids=_category_id} selected="selected" {ENDIF} >{_name}</option> 

                                    
                                  {ENDFOR}     
                          </select>
                             
                          </div>

                          <div class="index-group">
                          </div>

                          <div class="index-group">
                          </div>
                    </div>                     
                  </div> </div> 

                  <!-- 2017-6-15 zxx 修改 -->
                  <div class="col-md-12">
                    <div class="col-md-5">
                        <div class="index-group clearfix">
                          <label for="">图片高度：</label>
                          <input type="text" class="form-control form-input" placeholder="请输入图片高度" value='{_height}' id='height' style="height:34px;">
                        </div>
                    </div>  
                  </div>
                  <div class="col-md-12">
                      <div class="col-md-5">
                      	<div class="index-group clearfix" style="margin-top:20px">
                          <label for="">排序:</label>
                          <div class="i_box clearfix">
                            <a href="javascript:;" class="J_minus" style="float: left;">-</a>
                            <input type="text" value="{_sort_order}" class="J_input" id='sort_order'/>
                            <a href="javascript:;" class="J_add" style="float: left;">+</a>
                          </div>
                      </div>  
                      </div>
                  </div>    
                    <input type="hidden" name="banner_image_id" id="c_id" value="{_banner_image_id}">
                     <input type='hidden' value='{_banner_id}' name='banner_id'> 
                  <div class="col-md-12">
                    <button type="submit"  class="btn btn-primary banner-save" style="margin-left: 10px;" onclick="sendAjax()" id='submit'>保存</button>
                  </div>  
                </form>
                </div>
                
              </div>
            </div>
            
            
        </div>
      </div>
    </section>
  </div>

  <!--底部-->
 {_INCLUDE footer.html}

</div>

</body>
</html>


<script src="view/assets/AdminLTE/dist/js/jquery.treemenu.js"></script>

<script type="text/javascript">
  function check(){
    var name=$("#name").val();
    var option=$("#banner-select").val();
    var msg=$('#fenlei-input').val();
    if(name==''){
      alert('标题不能为空'); return false;
    }
    if(option == 1){
      if(msg==''){
        alert('请选择商品分类'); return false;
      }
    }
  }

</script>

<script>
  $(function() {

      $("#site").change(function(){
        var id=$(this).val();
        if(id==13){
          $(".show").removeAttr("disabled")
        }else{
          $(".show").attr("disabled","disabled");
        }
      });


      $(".dropdown-btn").click(function(){
        if($(".tree").is(":hidden")){
             $(".tree").show();   
      }else{
            $(".tree").hide();    
      }
      })
    $(".tree").treemenu({ delay: 300 }).openActive();
    
  });
</script>

</script>



<!-- 点击下拉列表框，将内容传到文本框 -->
<script type="text/javascript">
  $(".sslist li").click(function(){
    var str=$(this).attr("value");//$(".sslist li").eq($(this).index())
    //$("#fenlei-input").val(11);
    //通过获取到的商品编号通过ajax请求获取到商品名称
    var data={str:str};
    var url="{_getProductName}";
    $.post(url,data,function(msg){
        $("#fenlei-input").val(msg);
    });
    //alert(str);
    
  });
</script>


<!-- 点击商品弹出 -->
<script type="text/javascript">
    function showweb(){
       var site=$("#site").val();
        //获取到页面中的信息
        var photo=$('#photo').val();
        photo=photo.replace("C:\\fakepath\\",'');
        var name=$("#name").val();
        var banner_select=$('#banner-select').val();
        var sort_order=$('#sort_order').val();
        if(photo==''){
          photo="{_image}";
        }
        var data={photo:photo,name:name,banner_select:banner_select,sort_order:sort_order,site:site};
        var url="{_updateAd}";
        var url1="{_getGoodsList}";
        $.post(url,data,function(msg){
          //alert(msg);
          location.href=url1+"&banner_image_id="+{_banner_image_id}+"&banner_id="+{_banner_id};
        });
      
    }
</script>

<!-- 点击活动商品弹出 -->
<script type="text/javascript">
    function showactivity(){
      var url="{_getGoodsActivityList}";
      location.href=url+"&banner_image_id="+{_banner_image_id}+"&banner_id="+{_banner_id};
    }
</script>

<!-- 点击下拉列表框，将内容传到文本框 -->
<script type="text/javascript">
  $(".sslist li").click(function(){
    var str=$(this).attr("value");//$(".sslist li").eq($(this).index())
    //$("#fenlei-input").val(11);
    //通过获取到的商品编号通过ajax请求获取到商品名称
    var data={str:str};
    var url="{_getProductName}";
    $.post(url,data,function(msg){
        $("#fenlei-input").val(msg);
    });
    
  });
</script>
<!-- 点击保存，提交ajax请求 -->
  <script type="text/javascript">
      function sendAjax(){
        var site=$("#site").val();
        //获取到页面中的信息
        var photo=$('#photo').val();
        var name=$("#name").val();
        var link=$('#link').val();
        var banner_select=$('#banner-select').val();
        var fenlei_input=$('#fenlei-input').val();
        var inputString={_item_id};
        var sort_order=$('#sort_order').val();
        var banner_image_id={_banner_image_id};
        var banner_id={_banner_id};
        var activity=$("#activity-select").val();
        var height=$("#height").val();
        var url="{_SaveAd}";
        var url1="{_homepage}";
        
        if(photo == ''){
          //说明使用的是原图片
          photo="{_image}";       
        }else{
          //不是原图片，进行拼接
          photo=photo.replace("C:\\fakepath\\",'');
        }
        
         var data={banner_image_id:banner_image_id,photo:photo,name:name,link:link,banner_select:banner_select,fenlei_input:fenlei_input,inputString:inputString,sort_order:sort_order,banner_id:banner_id,site:site,activity:activity,height:height};
         $.post(url,data,function(msg){
         });
      }
  </script>

  <script type="text/javascript">
     // 树状菜单
     $(document).ready(function () {
          $(".l1").toggle(function () {
              $(".slist").animate({ height: 'toggle', opacity: 'hide' }, "slow");
             $(this).next(".slist").animate({ height: 'toggle', opacity: 'toggle' }, "slow");
         }, function () {
             $(".slist").animate({ height: 'toggle', opacity: 'hide' }, "slow");
              $(this).next(".slist").animate({ height: 'toggle', opacity: 'toggle' }, "slow");
        });
  
        $(".l2").toggle(function () {
              $(this).next(".sslist").animate({ height: 'toggle', opacity: 'toggle' }, "slow");
        }, function () {
             $(this).next(".sslist").animate({ height: 'toggle', opacity: 'toggle' }, "slow");
         });
 
         $(".l2").click(function () {
             $(".l3").removeClass("currentl3");
            $(".l2").removeClass("currentl2");
             $(this).addClass("currentl2");
        });
 
         $(".l3").click(function () {
            $(".l3").removeClass("currentl3");
             $(this).addClass("currentl3");
        });
 
         $(".close").toggle(function () {
             $(".slist").animate({ height: 'toggle', opacity: 'show' }, "fast");
             $(".sslist").animate({ height: 'toggle', opacity: 'show' }, "fast");
        }, function () {
              $(".slist").animate({ height: 'toggle', opacity: 'hide' }, "fast");
             $(".sslist").animate({ height: 'toggle', opacity: 'hide' }, "fast");
         });
     });

     $(function(){
      $(".dropdown-btn").click(function(){
        if($(".menu").is(":hidden")){
             $(".menu").show();   
      }else{
            $(".menu").hide();    
      }
      })
     })
 </script>
 


<script>
$(function(){
  {_IF type=1}
     $(".fenlei_item .index-group").eq(0).show();
  {ELSE}
    {_IF subtype=0}
        $(".fenlei_item .index-group").eq(1).show();
    {ENDIF}
    {_IF subtype=1}
        $(".fenlei_item .index-group").eq(2).show();
    {ENDIF}
    {_IF subtype=5}
        $(".fenlei_item .index-group").eq(3).show();
    {ENDIF}  
  {ENDIF}
 
  $("#banner-select").change(function(){
     var index=$(this).find('option:selected').index();
     // console.log(index);
     $(".fenlei_item .index-group").eq(index).show();
     $(".fenlei_item .index-group").eq(index).siblings().hide();
  })
})

</script>

<!--排序-->
<script>
$.fn.iVaryVal=function(iSet,CallBack){
  /*
   * Minus:点击元素--减小
   * Add:点击元素--增加
   * Input:表单元素
   * Min:表单的最小值，非负整数
   * Max:表单的最大值，正整数
   */
  iSet=$.extend({Minus:$('.J_minus'),Add:$('.J_add'),Input:$('.J_input'),Min:0,Max:20},iSet);
  var C=null,O=null;
  //插件返回值
  var $CB={};
  //增加
  iSet.Add.each(function(i){
    $(this).click(function(){
      O=parseInt(iSet.Input.eq(i).val());
      (O+1<=iSet.Max) || (iSet.Max==null) ? iSet.Input.eq(i).val(O+1) : iSet.Input.eq(i).val(iSet.Max);
      //输出当前改变后的值
      $CB.val=iSet.Input.eq(i).val();
      $CB.index=i;
      //回调函数
      if (typeof CallBack == 'function') {
                CallBack($CB.val,$CB.index);
            }
    });
  });
  //减少
  iSet.Minus.each(function(i){
    $(this).click(function(){
      O=parseInt(iSet.Input.eq(i).val());
      O-1<iSet.Min ? iSet.Input.eq(i).val(iSet.Min) : iSet.Input.eq(i).val(O-1);
      $CB.val=iSet.Input.eq(i).val();
      $CB.index=i;
      //回调函数
      if (typeof CallBack == 'function') {
        CallBack($CB.val,$CB.index);
        }
    });
  });
  //手动
  iSet.Input.bind({
    'click':function(){
      O=parseInt($(this).val());
      $(this).select();
    },
    'keyup':function(e){
      if($(this).val()!=''){
        C=parseInt($(this).val());
        //非负整数判断
        if(/^[1-9]\d*|0$/.test(C)){
          $(this).val(C);
          O=C;
        }else{
          $(this).val(O);
        }
      }
      //键盘控制：上右--加，下左--减
      if(e.keyCode==38 || e.keyCode==39){
        iSet.Add.eq(iSet.Input.index(this)).click();
      }
      if(e.keyCode==37 || e.keyCode==40){
        iSet.Minus.eq(iSet.Input.index(this)).click();
      }
      //输出当前改变后的值
      $CB.val=$(this).val();
      $CB.index=iSet.Input.index(this);
      //回调函数
      if (typeof CallBack == 'function') {
                CallBack($CB.val,$CB.index);
            }
    },
    'blur':function(){
      $(this).trigger('keyup');
      if($(this).val()==''){
        $(this).val(O);
      }
      //判断输入值是否超出最大最小值
      if(iSet.Max){
        if(O>iSet.Max){
          $(this).val(iSet.Max);
        }
      }
      if(O<iSet.Min){
        $(this).val(iSet.Min);
      }
      //输出当前改变后的值
      $CB.val=$(this).val();
      $CB.index=iSet.Input.index(this);
      //回调函数
      if (typeof CallBack == 'function') {
                CallBack($CB.val,$CB.index);
            }
    }
  });
}
//调用
$( function() {
  
  $('.i_box').iVaryVal({},function(value,index){
    $('.i_tips').html('你点击的表单索引是：'+index+'；改变后的表单值是：'+value);
  });
  
});
</script>

<!--图片上传-->
  <script>
    document.getElementById('photo').addEventListener('change',function(e){
    
    var files = this.files;
    var img = new Image();
    var reader = new FileReader();
    reader.readAsDataURL(files[0]);
    reader.onload = function(e){
      var mb = (e.total/1024)/1024;
      if(mb>= 2){
        alert('文件大小大于2M');
        return;
      }
      img.src = this.result;
      img.style.width ="80%";
      document.getElementById('click').style.width="100%";
      document.getElementById('click').style.height="";
      document.getElementById('click').innerHTML = '';
      document.getElementById('click').appendChild(img);
    }
  });
  </script>